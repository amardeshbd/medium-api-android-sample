Android Sample - Medium API
===================
Sample android app for medium. It showcases process of generating Android Retrofit 2 api-client library from OpenAPI specification and how to use the `ApiClient` and retrofit.

> _DISCLAIMER: This application code has been generated using activity template provided in Android Studio. It is intended to showcase use of client library generated by swagger client. No effort has been made to follow industry's best practices for developing android apps. 
If you are interested in learning best practices for developing android apps, please follow Google's official guides found here: [https://github.com/googlesamples/android-architecture](https://github.com/googlesamples/android-architecture)_

Library Code Gen - Retrofit
--------------------------------
Install [swagger codegen](https://github.com/swagger-api/swagger-codegen) to be able to generate library specific code for certain language. For this example, we are going to generate **[Retrofit 2](http://square.github.io/retrofit/)** compliant Java library for [medium.com](https://github.com/Medium/medium-api-docs) using OpenAPI specification found in [medium-api-specification](https://github.com/amardeshbd/medium-api-specification). 

```
swagger-codegen generate --input-spec medium-api-specification.yaml --lang java --library retrofit2 --output medium-api-android-retrofit-client
```
> NOTE: If you haven't installed `swagger-codegen` via MacOSX's brew, you may replace `swagger-codegen` with `java -jar swagger-codegen-cli.jar` to use the jar distribution.

After successfull execution, it will generate code in destination folder defined by `--output` directory. Here is a **[snapshot](https://github.com/amardeshbd/medium-api-android-sample/tree/master/apilib/src/main/java/io/swagger/client)** of generated code found in this repository.

Once code is generated, you may choose any of the available options.

 * Option 1: Copy all the files under generated source and import in android project _(Used this method in current project - See `apilib` gradle module)_.
 * Option 2: You can execute `gradle build` to build jar file that can be included in your android project. 
 * Option 3: Use their `pom.xml` file to host library in maven repo

### Known issue on generated code:
During my testing I found bug in generated `ApiClient` class related to ApiKey authentication. Update following block of code to make it compatible with api key authentication. 


On the default constructor disable `createDefaultAdapter()` method as follows: 
```java
public ApiClient() {
    apiAuthorizations = new LinkedHashMap<String, Interceptor>();
    // createDefaultAdapter(); 
}
```

On `addAuthorization()` method disable the following line, which gives unsupported operation exception.
```java
// okClient.interceptors().add(authorization);
```

Finally on `createDefaultAdapter()` method implementation, initialize `okClient` using builder, which allows adding interceptors during build time.
```java
public void createDefaultAdapter() {
    // ... more code above ...
    OkHttpClient.Builder builder = new OkHttpClient.Builder();
    for (Map.Entry<String, Interceptor> entry : apiAuthorizations.entrySet()) {
        builder.addInterceptor(entry.getValue());
    }
    okClient = builder.build();
    
    // .. more code below ...
}
```

Remember, since the `ApiClient()` constructor does not invoke `createDefaultAdapter()`,  we need to manually invoke this after `ApiClient` instance is created. See example below.


Here is my **[github gist](https://gist.github.com/amardeshbd/063213c29ebc5bf98ff071df0c22a44c)** of modified `ApiClient` class.

> `TODO` Report this issue to swagger-codegen project. 


Using Generated Library
-----------------------
Once you have generated code with modification mentioned above, you can use your [generated self-issued access tokens](https://github.com/Medium/medium-api-docs#22-self-issued-access-tokens) from medium.com's [user settings](https://medium.com/me/settings) to access the endpoints. 

Create an instance of `ApiClient` using following code. 

```java
    final String BEARER = "Bearer"; // For header based API-Key authentication
    final String TOKEN = ""; // Your self-issued access tokens
    private ApiClient apiClient;
    
    apiClient = new ApiClient(BEARER, BEARER + " " + TOKEN);
    apiClient.createDefaultAdapter(); // initializes the client with URL, HTTP Client, Gson and so on.
```

Once you have the api client instance, you can create retrofit service class and invoke the api. See [Retrofit](http://square.github.io/retrofit/) for more info. 

Here is an example of invoking `/me` api endpoint using asynchronous call _(Source: [MainActivity.java](https://github.com/amardeshbd/medium-api-android-sample/blob/master/app/src/main/java/info/hossainkhan/mediumsample/MainActivity.java))_

```java
    UsersApi usersApi = apiClient.createService(UsersApi.class);
    Call<UserResponse> userResponseCall = usersApi.meGet();
    
    userResponseCall.enqueue(new Callback<UserResponse>() {
        @Override
        public void onResponse(Call<UserResponse> call, Response<UserResponse> response) {
            if(response.isSuccessful()) {
                User userInfo = response.body().getData();
                // Use the `userInfo` object to update UI
            } else {
                // API access denied - show message (eg. `response.errorBody().source().toString()` )
            }
        }
    
        @Override
        public void onFailure(Call<UserResponse> call, Throwable t) {
            // Network request failed.
        }
    });
```

Example to `publications/{publicationId}/contributors` API call can also be found at _[PublicationListActivity.java](https://github.com/amardeshbd/medium-api-android-sample/blob/master/app/src/main/java/info/hossainkhan/mediumsample/PublicationListActivity.java)_

Retrofit + RxJava
-------------------
If you are interested in [RxJava](https://github.com/ReactiveX/RxJava), you can generate retrofit+rxjava client library using the following command line

```
swagger-codegen generate --input-spec medium-api-specification.yaml --lang java --library retrofit2 -DuseRxJava=true --output medium-api-android-retrofit-rxjava-client
```

See swagger-codegen project's documentation for more hidden features `^_^`

License
===================
This project is subject to The MIT License (MIT).
